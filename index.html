<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sneakers AR Experience</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: white;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
      position: fixed;
    }

    /* Camera Background - Always visible */
    #cameraBackground {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 1;
    }

    /* AR Grid Overlay */
    .ar-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: 
        linear-gradient(0deg, transparent 24%, rgba(0, 212, 255, 0.05) 25%, rgba(0, 212, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 212, 255, 0.05) 75%, rgba(0, 212, 255, 0.05) 76%, transparent 77%, transparent),
        linear-gradient(90deg, transparent 24%, rgba(0, 212, 255, 0.05) 25%, rgba(0, 212, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(0, 212, 255, 0.05) 75%, rgba(0, 212, 255, 0.05) 76%, transparent 77%, transparent);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 2;
      opacity: 0;
      animation: gridFadeIn 2s ease-in-out forwards;
    }

    @keyframes gridFadeIn {
      to { opacity: 0.4; }
    }

    /* AR Scan Line */
    .scan-line {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #00ff9d, transparent);
      box-shadow: 0 0 20px #00ff9d;
      z-index: 3;
      animation: scan 3s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes scan {
      0%, 100% { transform: translateY(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(100vh); opacity: 0; }
    }

    /* AR Corner Markers */
    .corner-marker {
      position: fixed;
      width: 40px;
      height: 40px;
      border: 3px solid #00d4ff;
      z-index: 3;
      pointer-events: none;
      opacity: 0;
      animation: markerFadeIn 1s ease-in-out 0.5s forwards;
    }

    @keyframes markerFadeIn {
      to { opacity: 0.8; }
    }

    .corner-marker.top-left {
      top: 20px;
      left: 20px;
      border-right: none;
      border-bottom: none;
    }

    .corner-marker.top-right {
      top: 20px;
      right: 20px;
      border-left: none;
      border-bottom: none;
    }

    .corner-marker.bottom-left {
      bottom: 20px;
      left: 20px;
      border-right: none;
      border-top: none;
    }

    .corner-marker.bottom-right {
      bottom: 20px;
      right: 20px;
      border-left: none;
      border-top: none;
    }

    /* Intro Screen */
    #introScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
    }

    .press-button {
      position: relative;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0, 212, 255, 0.3), rgba(0, 153, 204, 0.5));
      border: 3px solid #00d4ff;
      cursor: pointer;
      box-shadow: 0 0 60px rgba(0, 212, 255, 0.8), inset 0 0 40px rgba(0, 212, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      color: white;
      text-align: center;
      padding: 20px;
      animation: pulseButton 2s infinite;
      backdrop-filter: blur(10px);
    }

    @keyframes pulseButton {
      0%, 100% { transform: scale(1); box-shadow: 0 0 60px rgba(0, 212, 255, 0.8), inset 0 0 40px rgba(0, 212, 255, 0.3); }
      50% { transform: scale(1.05); box-shadow: 0 0 80px rgba(0, 212, 255, 1), inset 0 0 60px rgba(0, 212, 255, 0.5); }
    }

    .press-button::before {
      content: '';
      position: absolute;
      width: 250px;
      height: 250px;
      border-radius: 50%;
      border: 2px solid rgba(0, 212, 255, 0.4);
      animation: rippleEffect 2s infinite;
    }

    @keyframes rippleEffect {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.4); opacity: 0; }
    }

    .disclaimer {
      position: absolute;
      bottom: 30px;
      text-align: center;
      font-size: 11px;
      opacity: 0.9;
      padding: 0 40px;
      line-height: 1.4;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      padding: 15px 30px;
      border-radius: 20px;
    }

    /* Video Screen */
    #videoScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 90;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .volume-warning {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(15px);
      padding: 14px 28px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 15px;
      font-weight: 600;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
      z-index: 95;
      border: 2px solid rgba(0, 212, 255, 0.3);
    }

    .volume-icon {
      width: 24px;
      height: 24px;
      filter: brightness(0) invert(1);
    }

    .video-container {
      position: relative;
      width: 90%;
      max-width: 380px;
      aspect-ratio: 9/16;
      border-radius: 30px;
      overflow: hidden;
      box-shadow: 0 0 80px rgba(0, 212, 255, 0.7), 0 0 120px rgba(0, 255, 157, 0.4);
      border: 3px solid rgba(0, 212, 255, 0.8);
      background: rgba(0, 0, 0, 0.4);
    }

    #videoPlayer {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    #videoPlayer::-webkit-media-controls {
      display: none !important;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(3px);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      z-index: 10;
    }

    .video-overlay.active {
      display: flex;
    }

    .visualize-button {
      padding: 20px 50px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      border: none;
      background: linear-gradient(135deg, #00d4ff, #00ff9d);
      color: #000;
      cursor: pointer;
      box-shadow: 0 15px 50px rgba(0, 212, 255, 0.8);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .visualize-button:active {
      transform: scale(0.95);
    }

    /* Models Screen */
    #modelsScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 80;
      display: none;
      overflow-y: auto;
      padding: 100px 15px 30px;
    }

    .models-header {
      text-align: center;
      margin-bottom: 25px;
      position: relative;
      z-index: 85;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: 25px;
      border: 2px solid rgba(0, 212, 255, 0.3);
      margin: 0 15px 25px;
    }

    .models-header h2 {
      font-size: 26px;
      font-weight: 800;
      background: linear-gradient(90deg, #00ff9d, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
      text-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
    }

    .models-header p {
      font-size: 13px;
      opacity: 0.9;
    }

    .shoes-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      max-width: 500px;
      margin: 0 auto;
      position: relative;
      z-index: 85;
    }

    .shoe-card {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 25px;
      overflow: hidden;
      backdrop-filter: blur(20px);
      border: 2px solid rgba(0, 212, 255, 0.4);
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.7), 0 0 30px rgba(0, 212, 255, 0.2);
      transition: all 0.3s ease;
    }

    .shoe-card:active {
      transform: scale(0.98);
    }

    .model-wrap { 
      height: 280px; 
      background: rgba(0, 0, 0, 0.3);
      position: relative;
      border-bottom: 2px solid rgba(0, 212, 255, 0.2);
    }
    
    model-viewer { 
      width: 100%; 
      height: 100%; 
      background: transparent; 
    }

    .info { 
      padding: 20px; 
      text-align: center; 
    }
    
    .info h3 { 
      font-size: 20px; 
      margin-bottom: 8px; 
      font-weight: 700;
      color: #00ff9d;
    }
    
    .info .price { 
      opacity: 0.9; 
      font-size: 18px; 
      margin-bottom: 18px;
      font-weight: 600;
    }

    .btn-3d-home {
      background: linear-gradient(135deg, #00d4ff, #00ff9d);
      color: #000;
      border: none;
      padding: 16px 24px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 0 auto;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0, 212, 255, 0.5);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .btn-3d-home:active { 
      transform: scale(0.95); 
    }

    /* AR Detail View */
    #arDetailView { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100vw; 
      height: 100vh; 
      display: none; 
      z-index: 110; 
    }

    #ar3DModel {
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100vw; 
      height: 100vh; 
      z-index: 111;
      --poster-color: transparent;
    }

    /* AR Controls */
    .ar-controls {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 115;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 90%;
    }

    .ar-control-btn {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(15px);
      border: 2px solid rgba(0, 212, 255, 0.5);
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .ar-control-btn:active {
      transform: scale(0.95);
    }

    .ar-control-btn.active {
      background: rgba(0, 212, 255, 0.8);
      border-color: #00ff9d;
      color: #000;
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.8);
    }

    /* Color Picker Panel */
    .color-panel {
      position: fixed;
      bottom: 220px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: 25px;
      border: 2px solid rgba(0, 212, 255, 0.5);
      z-index: 114;
      display: none;
      flex-direction: column;
      gap: 15px;
      max-width: 90%;
      box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
    }

    .color-panel.active {
      display: flex;
    }

    .color-label {
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #00ff9d;
    }

    .color-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .color-btn {
      padding: 14px 20px;
      border-radius: 25px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .color-btn:active {
      transform: scale(0.95);
    }

    .color-btn.selected {
      background: linear-gradient(135deg, #00d4ff, #00ff9d);
      border-color: #00ff9d;
      color: #000;
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.8);
    }

    #closeARDetail {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 18px 50px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      border: 2px solid rgba(0, 212, 255, 0.5);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(15px);
      color: white;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
      z-index: 115;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .size-info {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(15px);
      padding: 15px 20px;
      border-radius: 20px;
      border: 2px solid rgba(0, 212, 255, 0.4);
      z-index: 113;
      font-size: 14px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);
    }

    .size-info strong {
      color: #00ff9d;
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <!-- Camera Background -->
  <video id="cameraBackground" autoplay playsinline muted></video>

  <!-- AR Visual Effects -->
  <div class="ar-grid"></div>
  <div class="scan-line"></div>
  <div class="corner-marker top-left"></div>
  <div class="corner-marker top-right"></div>
  <div class="corner-marker bottom-left"></div>
  <div class="corner-marker bottom-right"></div>

  <!-- Intro Screen -->
  <div id="introScreen">
    <button class="press-button" id="startBtn">
      PRESS<br>TO START<br>EXPERIENCE
    </button>
    <div class="disclaimer">
      The experience may cause your phone to vibrate.<br>
      Please maintain a tight grip.<br><br>
      <small>This is a work of creative visualisation, for entertainment purposes only.</small>
    </div>
  </div>

  <!-- Video Screen -->
  <div id="videoScreen">
    <div class="volume-warning">
      <img src="https://cdn-icons-png.flaticon.com/512/727/727245.png" class="volume-icon">
      <span>VOLUME UP</span>
    </div>
    
    <div class="video-container">
      <video id="videoPlayer" playsinline>
        <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
      </video>
      
      <div class="video-overlay" id="videoOverlay">
        <button class="visualize-button" id="visualizeBtn">
          View Models
        </button>
      </div>
    </div>
  </div>

  <!-- Models Screen -->
  <div id="modelsScreen">
    <div class="models-header">
      <h2>Choose Your Sneaker</h2>
      <p>Select a model to view in Augmented Reality</p>
    </div>
    <div class="shoes-grid" id="shoesGrid"></div>
  </div>

  <!-- AR Detail View -->
  <div id="arDetailView">
    <model-viewer id="ar3DModel"
      ar ar-modes="webxr scene-viewer quick-look"
      camera-controls
      shadow-intensity="1.5"
      exposure="1.2"
      camera-orbit="0deg 75deg 1.5m"
      min-camera-orbit="auto auto 0.5m"
      max-camera-orbit="auto auto 3m"
      environment-image="neutral">
      <button slot="ar-button" style="display:none;"></button>
    </model-viewer>

    <div class="size-info" id="sizeInfo">
      <strong>AR MODE</strong>
      <div id="modelName">New Balance 997</div>
    </div>

    <div class="ar-controls">
      <button class="ar-control-btn" id="colorToggle">ðŸŽ¨ Colors</button>
      <button class="ar-control-btn" id="rotateBtn">ðŸ”„ Rotate</button>
      <button class="ar-control-btn" id="resetBtn">â†» Reset</button>
    </div>

    <div class="color-panel" id="colorPanel">
      <div class="color-label">Select Color Variant</div>
      <div class="color-options" id="colorOptions">
        <button class="color-btn" data-color="original">Original</button>
        <button class="color-btn" data-color="black">Midnight Black</button>
        <button class="color-btn" data-color="white">Pure White</button>
        <button class="color-btn" data-color="red">Sport Red</button>
        <button class="color-btn" data-color="blue">Ocean Blue</button>
        <button class="color-btn" data-color="grey">Storm Grey</button>
      </div>
    </div>

    <button id="closeARDetail">Back to Models</button>
  </div>

  <script>
    const shoes = [
      { name: "New Balance 997", price: "â‚¹14,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2001%20(1).glb" },
      { name: "Formal Edge", price: "â‚¹12,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2002%20(1).glb" },
      { name: "ND Runner", price: "â‚¹16,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2003%20(1).glb" }
    ];

    const cameraBackground = document.getElementById("cameraBackground");
    const introScreen = document.getElementById("introScreen");
    const videoScreen = document.getElementById("videoScreen");
    const modelsScreen = document.getElementById("modelsScreen");
    const arDetailView = document.getElementById("arDetailView");
    const ar3DModel = document.getElementById("ar3DModel");
    const startBtn = document.getElementById("startBtn");
    const visualizeBtn = document.getElementById("visualizeBtn");
    const videoPlayer = document.getElementById("videoPlayer");
    const videoOverlay = document.getElementById("videoOverlay");
    const closeARDetail = document.getElementById("closeARDetail");
    const shoesGrid = document.getElementById("shoesGrid");
    const colorPanel = document.getElementById("colorPanel");
    const colorToggle = document.getElementById("colorToggle");
    const rotateBtn = document.getElementById("rotateBtn");
    const resetBtn = document.getElementById("resetBtn");
    const sizeInfo = document.getElementById("sizeInfo");
    const modelName = document.getElementById("modelName");

    let cameraStream = null;
    let autoRotate = false;
    let currentShoe = null;

    // Initialize camera immediately on page load
    async function initCamera() {
      try {
        const constraints = {
          video: {
            facingMode: { ideal: "environment" },
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          }
        };
        
        cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraBackground.srcObject = cameraStream;
        await cameraBackground.play();
        
        console.log("Camera initialized successfully");
      } catch (err) {
        console.error("Camera access error:", err);
        // Fallback gradient if camera fails
        document.body.style.background = "linear-gradient(135deg, #0f0c29, #302b63, #24243e)";
      }
    }

    // Start camera on page load
    initCamera();

    // Start button
    startBtn.onclick = async () => {
      introScreen.style.display = "none";
      videoScreen.style.display = "flex";
      videoPlayer.play();
    };

    // Video ended event
    videoPlayer.addEventListener('ended', () => {
      videoOverlay.classList.add('active');
    });

    // Visualize button
    visualizeBtn.onclick = () => {
      videoScreen.style.display = "none";
      modelsScreen.style.display = "block";
    };

    // Generate shoe cards
    shoes.forEach(shoe => {
      const card = document.createElement("div");
      card.className = "shoe-card";
      card.innerHTML = `
        <div class="model-wrap">
          <model-viewer 
            src="${shoe.model}" 
            auto-rotate
            camera-controls 
            shadow-intensity="1.5" 
            exposure="1.2"
            camera-orbit="0deg 75deg 1.8m"
            loading="eager">
          </model-viewer>
        </div>
        <div class="info">
          <h3>${shoe.name}</h3>
          <div class="price">${shoe.price}</div>
          <button class="btn-3d-home" data-model="${shoe.model}" data-name="${shoe.name}">
            <img src="https://cdn-icons-png.flaticon.com/512/1087/1087080.png" 
                 style="width:24px;height:24px;filter:brightness(0)">
            View in AR
          </button>
        </div>
      `;
      shoesGrid.appendChild(card);
    });

    // View in AR buttons
    document.querySelectorAll('.btn-3d-home').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const modelUrl = btn.getAttribute('data-model');
        const name = btn.getAttribute('data-name');
        
        currentShoe = shoes.find(s => s.model === modelUrl);
        modelName.textContent = name;
        
        modelsScreen.style.display = "none";
        arDetailView.style.display = "block";
        ar3DModel.src = modelUrl;
        
        // Reset color selection
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
        document.querySelector('.color-btn[data-color="original"]').classList.add('selected');
      });
    });

    // Color toggle
    colorToggle.onclick = () => {
      colorPanel.classList.toggle('active');
      colorToggle.classList.toggle('active');
    };

    // Color selection
    document.querySelectorAll('.color-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        
        const color = btn.getAttribute('data-color');
        console.log("Selected color:", color);
        
        // Visual feedback
        btn.style.transform = 'scale(0.95)';
        setTimeout(() => btn.style.transform = '', 200);
      });
    });

    // Rotate control
    rotateBtn.onclick = () => {
      autoRotate = !autoRotate;
      ar3DModel.autoRotate = autoRotate;
      rotateBtn.classList.toggle('active');
    };

    // Reset view
    resetBtn.onclick = () => {
      ar3DModel.resetTurntableRotation();
      ar3DModel.cameraOrbit = "0deg 75deg 1.5m";
      resetBtn.classList.add('active');
      setTimeout(() => resetBtn.classList.remove('active'), 300);
    };

    // Close AR detail view
    closeARDetail.onclick = () => {
      arDetailView.style.display = "none";
      modelsScreen.style.display = "block";
      colorPanel.classList.remove('active');
      colorToggle.classList.remove('active');
    };

    // Prevent video controls
    videoPlayer.addEventListener('contextmenu', (e) => e.preventDefault());

    // Cleanup on exit
    window.addEventListener('beforeunload', () => {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
      }
    });
  </script>
</body>
</html>
