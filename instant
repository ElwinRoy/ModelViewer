<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sneakers AR Try-On</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: white;
      overflow: hidden;
    }

    header { text-align: center; padding: 50px 20px 20px; }
    h1 {
      font-size: 36px; font-weight: 800;
      background: linear-gradient(90deg, #00ff9d, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .shoes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 22px;
      padding: 20px;
      padding-bottom: 100px;
    }

    .shoe-card {
      background: rgba(255,255,255,0.08);
      border-radius: 24px;
      overflow: hidden;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.12);
    }

    .model-wrap { height: 190px; background: #000; }
    model-viewer { width: 100%; height: 100%; background: transparent; }

    .info { padding: 16px; text-align: center; }
    .info h3 { font-size: 17px; margin-bottom: 6px; font-weight: 600; }
    .info .price { opacity: 0.85; font-size: 15px; margin-bottom: 14px; }

    .btn-3d-home {
      background: linear-gradient(135deg, #9C27B0, #E91E63);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 0 auto;
      width: 88%;
      box-shadow: 0 10px 30px rgba(156, 39, 176, 0.5);
      transition: all 0.3s ease;
    }
    .btn-3d-home:active { transform: scale(0.95); }

    /* AR View */
    #arView { position:fixed; top:0; left:0; width:100vw; height:100vh; display:none; z-index:100; background:black; overflow:hidden; }
    #cameraView { width:100%; height:100%; object-fit:cover; display:none; }

    #ar3DModel {
      position:fixed; top:0; left:0; width:100vw; height:100vh; display:none; z-index:115;
      --poster-color: transparent;
    }

    /* Background Overlay */
    #bgOverlay {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background-size: cover;
      background-position: center;
      opacity: 0.85;
      z-index: 105;
      display: none;
      transition: background 0.6s ease;
    }

    /* Background Buttons */
    #btnBgRocky, #btnBgTrack {
      position: fixed;
      bottom: 140px;
      padding: 18px 32px;
      font-size: 19px;
      font-weight: bold;
      border-radius: 50px;
      border: none;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7);
      z-index: 120;
      cursor: pointer;
      color: white;
      display: flex;
      align-items: center;
      gap: 14px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s ease;
    }

    #btnBgRocky {
      left: 20px;
      background: linear-gradient(135deg, #8B4513, #D2691E);
    }
    #btnBgTrack {
      right: 20px;
      background: linear-gradient(135deg, #228B22, #32CD32);
    }

    .active-bg-btn {
      opacity: 1 !important;
      pointer-events: all !important;
      transform: scale(1.1);
      box-shadow: 0 0 40px rgba(255,255,255,0.6) !important;
    }

    /* Exit & Close */
    #closeAR, #btnExit3D {
      position: fixed;
      padding: 16px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      border: none;
      box-shadow: 0 12px 35px rgba(0,0,0,0.6);
      z-index: 120;
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s ease;
    }

    #closeAR {
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.25);
      backdrop-filter: blur(12px);
      color: white;
    }

    #btnExit3D {
      bottom: 150px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      display: none;
    }

    /* NEW BACK BUTTON */
    #btnBackAR {
      position: fixed;
      top: 30px;
      left: 20px;
      padding: 12px 26px;
      font-size: 17px;
      font-weight: bold;
      border-radius: 50px;
      border: none;
      color: white;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
      z-index: 130;
      cursor: pointer;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
    }

    #btnBackAR.active-btn {
      opacity: 1;
      pointer-events: all;
    }

    .icon { width: 34px; height: 34px; filter: brightness(0) invert(1); }
  </style>
</head>
<body>

  <header>
    <h1>Choose Your Footwear</h1>
    <p>Tap the button below each shoe to view in AR / 3D</p>
  </header>

  <div class="shoes-grid" id="shoesGrid"></div>

  <div id="arView">
    <video id="cameraView" autoplay playsinline muted></video>
    <div id="bgOverlay"></div>

    <model-viewer id="ar3DModel"
      ar ar-modes="webxr scene-viewer quick-look"
      camera-controls auto-rotate
      shadow-intensity="2" exposure="1.1"
      environment-image="neutral"
      style="width:100%; height:100%; background:transparent;">
      <button slot="ar-button" style="display:none;"></button>
    </model-viewer>

    <button id="btnBgRocky">
      <img src="https://cdn-icons-png.flaticon.com/512/869/869061.png" class="icon"> Rocky
    </button>
    <button id="btnBgTrack">
      <img src="https://cdn-icons-png.flaticon.com/512/2972/2972165.png" class="icon"> Track
    </button>

    <button id="closeAR">Close</button>
    <button id="btnExit3D">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 6L6 18M6 6l12 12"></path>
      </svg>
      Exit 3D
    </button>

    <!-- NEW BACK BUTTON -->
    <button id="btnBackAR">⬅ Back</button>
  </div>

  <script>
    const shoes = [
      { name: "New balance 997", price: "₹14,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2001%20(1).glb" },
      { name: "Formal Edge", price: "₹12,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2002%20(1).glb" },
      { name: "ND Runner", price: "₹16,999", model: "https://cdn.jsdelivr.net/gh/ElwinRoy/test@main/Shoe%2003%20(1).glb" }
    ];

    const grid = document.getElementById("shoesGrid");
    const arView = document.getElementById("arView");
    const camera = document.getElementById("cameraView");
    const bgOverlay = document.getElementById("bgOverlay");
    const ar3DModel = document.getElementById("ar3DModel");
    const closeAR = document.getElementById("closeAR");
    const btnBgRocky = document.getElementById("btnBgRocky");
    const btnBgTrack = document.getElementById("btnBgTrack");
    const btnExit3D = document.getElementById("btnExit3D");
    const btnBackAR = document.getElementById("btnBackAR");

    let currentShoe = null;

    shoes.forEach(shoe => {
      const card = document.createElement("div");
      card.className = "shoe-card";
      card.innerHTML = `
        <div class="model-wrap">
          <model-viewer src="${shoe.model}" auto-rotate camera-controls ar shadow-intensity="1.5" exposure="1.1" loading="eager"></model-viewer>
        </div>
        <div class="info">
          <h3>${shoe.name}</h3>
          <div class="price">${shoe.price}</div>
          <button class="btn-3d-home" data-model="${shoe.model}">
            <img src="https://cdn-icons-png.flaticon.com/512/1087/1087080.png" style="width:26px;height:26px;filter:brightness(0)invert(1)">
            View in AR / 3D
          </button>
        </div>
      `;
      grid.appendChild(card);
    });

    document.querySelectorAll('.btn-3d-home').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        e.stopPropagation();
        const modelUrl = btn.getAttribute('data-model');
        currentShoe = shoes.find(s => s.model === modelUrl);

        arView.style.display = "block";
        bgOverlay.style.display = "block";

        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
          camera.srcObject = stream;
        } catch (err) {
          console.log("Camera denied, continuing in 3D mode");
        }

        ar3DModel.src = modelUrl;
        ar3DModel.style.display = "block";

        bgOverlay.style.background = "url('https://images.unsplash.com/photo-1558618666-418893e633e3?w=1200&q=80') center/cover no-repeat";

        setTimeout(() => {
          closeAR.classList.add("active-btn");
          btnBgRocky.classList.add("active-bg-btn", "active-btn");
          btnBgTrack.classList.add("active-btn");
          btnExit3D.style.display = "block";
          btnExit3D.classList.add("active-btn");
          btnBackAR.classList.add("active-btn");
        }, 800);
      });
    });

    btnBgRocky.onclick = () => {
      bgOverlay.style.background = "url('https://images.unsplash.com/photo-1558618666-418893e633e3?w=1200&q=80') center/cover no-repeat";
      btnBgRocky.classList.add("active-bg-btn");
      btnBgTrack.classList.remove("active-bg-btn");
    };

    btnBgTrack.onclick = () => {
      bgOverlay.style.background = "url('https://images.unsplash.com/photo-1594736797933-d0501ba2fe65?w=1200&q=80') center/cover no-repeat";
      btnBgTrack.classList.add("active-bg-btn");
      btnBgRocky.classList.remove("active-bg-btn");
    };

    const exitAR = () => {
      camera.srcObject?.getTracks().forEach(t => t.stop());
      bgOverlay.style.display = "none";
      ar3DModel.style.display = "none";
      arView.style.display = "none";

      closeAR.classList.remove("active-btn");
      btnExit3D.style.display = "none";

      btnBgRocky.classList.remove("active-btn", "active-bg-btn");
      btnBgTrack.classList.remove("active-btn", "active-bg-btn");
      btnBackAR.classList.remove("active-btn");
    };

    closeAR.onclick = exitAR;
    btnExit3D.onclick = exitAR;
    btnBackAR.onclick = exitAR;
  </script>
</body>
</html>
